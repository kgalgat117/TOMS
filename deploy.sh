#!/bin/sh

echo "##########################################################################################################################################"
echo "starting deployment process..."
echo "##########################################################################################################################################"
echo "##########################################################################################################################################"
echo "adding changes to git..."
echo "##########################################################################################################################################"
git add .
echo "##########################################################################################################################################"
echo "commiting changes..."
echo "##########################################################################################################################################"
git commit -m "$1"
echo "##########################################################################################################################################"
echo "pushing changes to master..."
echo "##########################################################################################################################################"
git push -u origin master
echo "##########################################################################################################################################"
echo "checkking out dev branch..."
echo "##########################################################################################################################################"
git checkout dev
echo "##########################################################################################################################################"
echo "pulling changes from master"
echo "##########################################################################################################################################"
git pull origin master
echo "##########################################################################################################################################"
echo "building prod version..."
echo "##########################################################################################################################################"
ng build --prod
cd
cd Downloads
echo "##########################################################################################################################################"
echo "loggin in to server instance..."
echo "##########################################################################################################################################"
ssh -i "testinstance.pem" ubuntu@ec2-54-80-75-47.compute-1.amazonaws.com <<EOF
 echo "##########################################################################################################################################"
 echo "loggin successfull"
 echo "##########################################################################################################################################"
 cd /var/www/TOMS
 echo "##########################################################################################################################################"
 echo "pulling changes from dev..."
 echo "##########################################################################################################################################"
 git pull origin dev
 echo "##########################################################################################################################################"
 echo "stopping previous version..."
 echo "##########################################################################################################################################"
 forever stop toms
 echo "##########################################################################################################################################"
 echo "restarting appilication"
 echo "##########################################################################################################################################"
 forever start --id "toms" ./bin/www
 echo "##########################################################################################################################################"
 echo "deployment done."
 echo "##########################################################################################################################################"